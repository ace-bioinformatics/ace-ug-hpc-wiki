<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/containers/containers-hpc" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Containers on High Performance Compute Clusters | ACE UGANDA HPC Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ace-bioinformatics.github.io/ace-ug-hpc-wiki/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ace-bioinformatics.github.io/ace-ug-hpc-wiki/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ace-bioinformatics.github.io/ace-ug-hpc-wiki/docs/tutorials/containers/containers-hpc"><meta data-rh="true" property="og:locale" content="en_GB"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Containers on High Performance Compute Clusters | ACE UGANDA HPC Wiki"><meta data-rh="true" name="description" content="This tutorial covers running containerized workloads on ACE HPC. You&#x27;ll learn how to use Apptainer to pull and run containers, write SLURM job scripts, manage data with bind mounts, and optimize performance on the cluster."><meta data-rh="true" property="og:description" content="This tutorial covers running containerized workloads on ACE HPC. You&#x27;ll learn how to use Apptainer to pull and run containers, write SLURM job scripts, manage data with bind mounts, and optimize performance on the cluster."><link data-rh="true" rel="icon" href="https://ace.ac.ug/wp-content/uploads/2022/04/cropped-android-chrome-512x512-2.png"><link data-rh="true" rel="canonical" href="https://ace-bioinformatics.github.io/ace-ug-hpc-wiki/docs/tutorials/containers/containers-hpc"><link data-rh="true" rel="alternate" href="https://ace-bioinformatics.github.io/ace-ug-hpc-wiki/docs/tutorials/containers/containers-hpc" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://ace-bioinformatics.github.io/ace-ug-hpc-wiki/docs/tutorials/containers/containers-hpc" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Containers on HPC","item":"https://ace-bioinformatics.github.io/ace-ug-hpc-wiki/docs/tutorials/containers/containers-hpc"}]}</script><link rel="alternate" type="application/rss+xml" href="/ace-ug-hpc-wiki/blog/rss.xml" title="ACE UGANDA HPC Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ace-ug-hpc-wiki/blog/atom.xml" title="ACE UGANDA HPC Wiki Atom Feed"><link rel="stylesheet" href="/ace-ug-hpc-wiki/assets/css/styles.8c2d5ab2.css">
<script src="/ace-ug-hpc-wiki/assets/js/runtime~main.1915b59d.js" defer="defer"></script>
<script src="/ace-ug-hpc-wiki/assets/js/main.21391bb6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/ace-ug-hpc-wiki/img/ace.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ace-ug-hpc-wiki/"><div class="navbar__logo"><img src="/ace-ug-hpc-wiki/img/ace.png" alt="ACE logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/ace-ug-hpc-wiki/img/ace.png" alt="ACE logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">ACE UGANDA HPC WIKI</b></a><a class="navbar__item navbar__link" href="/ace-ug-hpc-wiki/docs/getting-started/accounts">Wiki</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/ace-bioinformatics/ace-hpc-wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ace-ug-hpc-wiki/docs/intro"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/ace-ug-hpc-wiki/docs/getting-started/accounts"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/ace-ug-hpc-wiki/docs/hardware/overview"><span title="Hardware" class="categoryLinkLabel_W154">Hardware</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/ace-ug-hpc-wiki/docs/running-jobs/slurm-basics"><span title="Running Jobs" class="categoryLinkLabel_W154">Running Jobs</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/ace-ug-hpc-wiki/docs/software/installed"><span title="Software" class="categoryLinkLabel_W154">Software</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/ace-ug-hpc-wiki/docs/support/faq"><span title="Support" class="categoryLinkLabel_W154">Support</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/ace-ug-hpc-wiki/docs/tutorials/overview"><span title="Tutorials" class="categoryLinkLabel_W154">Tutorials</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ace-ug-hpc-wiki/docs/tutorials/overview"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/ace-ug-hpc-wiki/docs/tutorials/containers/intro"><span title="Containers" class="categoryLinkLabel_W154">Containers</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ace-ug-hpc-wiki/docs/tutorials/containers/intro"><span title="What are Containers ?" class="linkLabel_WmDU">What are Containers ?</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ace-ug-hpc-wiki/docs/tutorials/containers/containerize-code"><span title="Containerize Your Code" class="linkLabel_WmDU">Containerize Your Code</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ace-ug-hpc-wiki/docs/tutorials/containers/containers-hpc"><span title="Containers on HPC" class="linkLabel_WmDU">Containers on HPC</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ace-ug-hpc-wiki/docs/tutorials/containers/advanced-builds"><span title="Advanced Build Topics" class="linkLabel_WmDU">Advanced Build Topics</span></a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/ace-ug-hpc-wiki/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Containers</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Containers on HPC</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Containers on High Performance Compute Clusters</h1></header>
<p>This tutorial covers running containerized workloads on ACE HPC. You&#x27;ll learn how to use Apptainer to pull and run containers, write SLURM job scripts, manage data with bind mounts, and optimize performance on the cluster.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="learning-objectives">Learning Objectives<a href="#learning-objectives" class="hash-link" aria-label="Direct link to Learning Objectives" title="Direct link to Learning Objectives" translate="no">​</a></h2>
<p>After completing this tutorial, you will be able to:</p>
<ul>
<li class="">Use Apptainer to pull and convert Docker images</li>
<li class="">Execute commands inside containers on ACE HPC</li>
<li class="">Write SLURM job scripts for containerized workflows</li>
<li class="">Manage input/output data with bind mounts</li>
<li class="">Run GPU and MPI jobs using containers</li>
<li class="">Troubleshoot common container issues on HPC</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="getting-started-with-apptainer">Getting Started with Apptainer<a href="#getting-started-with-apptainer" class="hash-link" aria-label="Direct link to Getting Started with Apptainer" title="Direct link to Getting Started with Apptainer" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="loading-the-apptainer-module">Loading the Apptainer Module<a href="#loading-the-apptainer-module" class="hash-link" aria-label="Direct link to Loading the Apptainer Module" title="Direct link to Loading the Apptainer Module" translate="no">​</a></h3>
<p>On ACE HPC, Apptainer is available as a module:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Load the Apptainer module</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify installation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer --version</span><br></span></code></pre></div></div>
<p><strong>Expected output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apptainer version 1.2.x</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pulling-container-images">Pulling Container Images<a href="#pulling-container-images" class="hash-link" aria-label="Direct link to Pulling Container Images" title="Direct link to Pulling Container Images" translate="no">​</a></h3>
<p>Apptainer can pull images from Docker Hub and other registries:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Pull from Docker Hub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer pull docker://python:3.11-slim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This creates: python_3.11-slim.sif</span><br></span></code></pre></div></div>
<p>The <code>.sif</code> (Singularity Image Format) file is Apptainer&#x27;s native format - a single, portable file containing the entire container.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pull-options">Pull Options<a href="#pull-options" class="hash-link" aria-label="Direct link to Pull Options" title="Direct link to Pull Options" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Specify output filename</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer pull python.sif docker://python:3.11-slim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Pull to a specific directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer pull ~/containers/pytorch.sif docker://pytorch/pytorch:2.0.1-cuda11.7-cudnn8-runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Force re-download (ignore cache)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer pull --force python.sif docker://python:3.11-slim</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="managing-the-cache">Managing the Cache<a href="#managing-the-cache" class="hash-link" aria-label="Direct link to Managing the Cache" title="Direct link to Managing the Cache" translate="no">​</a></h3>
<p>Apptainer caches downloaded layers:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># View cache location and size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer cache list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Clean the cache (free disk space)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer cache clean</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="exercise-1-pull-your-first-image">Exercise 1: Pull Your First Image<a href="#exercise-1-pull-your-first-image" class="hash-link" aria-label="Direct link to Exercise 1: Pull Your First Image" title="Direct link to Exercise 1: Pull Your First Image" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Create a container directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/containers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/containers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Load Apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Pull Python image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer pull docker://python:3.11-slim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls -lh python_3.11-slim.sif</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-containers">Running Containers<a href="#running-containers" class="hash-link" aria-label="Direct link to Running Containers" title="Direct link to Running Containers" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="three-ways-to-run">Three Ways to Run<a href="#three-ways-to-run" class="hash-link" aria-label="Direct link to Three Ways to Run" title="Direct link to Three Ways to Run" translate="no">​</a></h3>
<table><thead><tr><th>Command</th><th>Purpose</th><th>Example</th></tr></thead><tbody><tr><td><code>apptainer exec</code></td><td>Run a specific command</td><td><code>apptainer exec python.sif python script.py</code></td></tr><tr><td><code>apptainer run</code></td><td>Run the default command</td><td><code>apptainer run python.sif</code></td></tr><tr><td><code>apptainer shell</code></td><td>Interactive shell</td><td><code>apptainer shell python.sif</code></td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-exec-most-common">Using <code>exec</code> (Most Common)<a href="#using-exec-most-common" class="hash-link" aria-label="Direct link to using-exec-most-common" title="Direct link to using-exec-most-common" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Run a Python command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec python_3.11-slim.sif python --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run a Python script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec python_3.11-slim.sif python analysis.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run with arguments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec python_3.11-slim.sif python train.py --epochs 100 --batch-size 32</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-shell-interactive">Using <code>shell</code> (Interactive)<a href="#using-shell-interactive" class="hash-link" aria-label="Direct link to using-shell-interactive" title="Direct link to using-shell-interactive" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Start interactive shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer shell python_3.11-slim.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># You&#x27;ll see a new prompt:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Apptainer&gt; python --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Apptainer&gt; pip list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Apptainer&gt; exit</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-run-default-action">Using <code>run</code> (Default Action)<a href="#using-run-default-action" class="hash-link" aria-label="Direct link to using-run-default-action" title="Direct link to using-run-default-action" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Run the container&#x27;s default command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer run python_3.11-slim.sif</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="exercise-2-run-commands-in-containers">Exercise 2: Run Commands in Containers<a href="#exercise-2-run-commands-in-containers" class="hash-link" aria-label="Direct link to Exercise 2: Run Commands in Containers" title="Direct link to Exercise 2: Run Commands in Containers" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/containers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Execute a Python one-liner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec python_3.11-slim.sif python -c &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import sys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(f&#x27;Python version: {sys.version}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(f&#x27;Executable: {sys.executable}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check what packages are available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec python_3.11-slim.sif pip list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Start an interactive session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer shell python_3.11-slim.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Try: python, pip list, cat /etc/os-release, exit</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-bind-mounts">Understanding Bind Mounts<a href="#understanding-bind-mounts" class="hash-link" aria-label="Direct link to Understanding Bind Mounts" title="Direct link to Understanding Bind Mounts" translate="no">​</a></h2>
<p>By default, Apptainer automatically binds (mounts) several directories:</p>
<table><thead><tr><th>Host Directory</th><th>Container Path</th><th>Access</th></tr></thead><tbody><tr><td><code>$HOME</code></td><td><code>$HOME</code></td><td>Read/Write</td></tr><tr><td><code>$PWD</code></td><td><code>$PWD</code></td><td>Read/Write</td></tr><tr><td><code>/tmp</code></td><td><code>/tmp</code></td><td>Read/Write</td></tr></tbody></table>
<p>This means your home directory and current working directory are accessible inside the container.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="verifying-default-binds">Verifying Default Binds<a href="#verifying-default-binds" class="hash-link" aria-label="Direct link to Verifying Default Binds" title="Direct link to Verifying Default Binds" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check what you can access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec python_3.11-slim.sif ls ~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Your current directory is available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Hello from host&quot; &gt; test.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec python_3.11-slim.sif cat test.txt</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-bind-mounts">Custom Bind Mounts<a href="#custom-bind-mounts" class="hash-link" aria-label="Direct link to Custom Bind Mounts" title="Direct link to Custom Bind Mounts" translate="no">​</a></h3>
<p>Use <code>--bind</code> or <code>-B</code> to mount additional directories:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Mount a data directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --bind /data/shared:/data python_3.11-slim.sif ls /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Mount read-only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --bind /data/shared:/data:ro python_3.11-slim.sif ls /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Mount multiple directories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --bind /data/input:/input:ro \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --bind /scratch/$USER:/output \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    python_3.11-slim.sif python process.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Mount with different path inside container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --bind /data/project/raw_reads:/reads python_3.11-slim.sif ls /reads</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="slurm-job-scripts-for-containers">SLURM Job Scripts for Containers<a href="#slurm-job-scripts-for-containers" class="hash-link" aria-label="Direct link to SLURM Job Scripts for Containers" title="Direct link to SLURM Job Scripts for Containers" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-container-job">Basic Container Job<a href="#basic-container-job" class="hash-link" aria-label="Direct link to Basic Container Job" title="Direct link to Basic Container Job" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --job-name=container-job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --output=%x_%j.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --error=%x_%j.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --time=01:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --nodes=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --ntasks=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --cpus-per-task=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=8G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Load Apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Define paths</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER=~/containers/python_3.11-slim.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SCRIPT=~/project/analysis.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run the container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec $CONTAINER python $SCRIPT</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="job-with-data-binding">Job with Data Binding<a href="#job-with-data-binding" class="hash-link" aria-label="Direct link to Job with Data Binding" title="Direct link to Job with Data Binding" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --job-name=data-analysis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --output=%x_%j.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --error=%x_%j.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --time=04:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --nodes=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --ntasks=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --cpus-per-task=8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=32G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Paths</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER=~/containers/datascience.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INPUT_DIR=/data/shared/project/raw_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OUTPUT_DIR=/scratch/$USER/results_$SLURM_JOB_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create output directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $OUTPUT_DIR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run with bind mounts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --bind $INPUT_DIR:/input:ro \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --bind $OUTPUT_DIR:/output \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $CONTAINER python /app/analyze.py \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --input /input \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --output /output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy results to permanent storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -r $OUTPUT_DIR /data/shared/project/results/</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="exercise-3-submit-a-container-job">Exercise 3: Submit a Container Job<a href="#exercise-3-submit-a-container-job" class="hash-link" aria-label="Direct link to Exercise 3: Submit a Container Job" title="Direct link to Exercise 3: Submit a Container Job" translate="no">​</a></h2>
<p>Create a complete job workflow:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/container-job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/container-job</span><br></span></code></pre></div></div>
<p>Create a Python script:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; process.py &lt;&lt; &#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/env python3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;Sample processing script.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from datetime import datetime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output_dir = os.environ.get(&#x27;OUTPUT_DIR&#x27;, &#x27;/output&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    job_id = os.environ.get(&#x27;SLURM_JOB_ID&#x27;, &#x27;local&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;Job ID: {job_id}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;Output directory: {output_dir}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;Processing started at: {datetime.now()}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Simulate some work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    results = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;job_id&#x27;: job_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;timestamp&#x27;: datetime.now().isoformat(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;status&#x27;: &#x27;completed&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;data&#x27;: list(range(10))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Save results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output_file = os.path.join(output_dir, f&#x27;results_{job_id}.json&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    with open(output_file, &#x27;w&#x27;) as f:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        json.dump(results, f, indent=2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;Results saved to: {output_file}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;Processing completed at: {datetime.now()}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<p>Create the job script:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; job.sh &lt;&lt; &#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --job-name=container-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --output=%x_%j.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --error=%x_%j.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --time=00:10:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --nodes=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --ntasks=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=2G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Setup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORK_DIR=~/container-job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OUTPUT_DIR=$WORK_DIR/output_$SLURM_JOB_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $OUTPUT_DIR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --env OUTPUT_DIR=$OUTPUT_DIR \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ~/containers/python_3.11-slim.sif \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    python $WORK_DIR/process.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Show results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Output files:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls -la $OUTPUT_DIR/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<p>Submit and monitor:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sbatch job.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">squeue -u $USER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># After completion:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat container-test_*.out</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="gpu-jobs-with-containers">GPU Jobs with Containers<a href="#gpu-jobs-with-containers" class="hash-link" aria-label="Direct link to GPU Jobs with Containers" title="Direct link to GPU Jobs with Containers" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="enabling-gpu-access">Enabling GPU Access<a href="#enabling-gpu-access" class="hash-link" aria-label="Direct link to Enabling GPU Access" title="Direct link to Enabling GPU Access" translate="no">​</a></h3>
<p>Use the <code>--nv</code> flag to enable NVIDIA GPU access:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --nv pytorch-gpu.sif python train.py</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="gpu-slurm-job">GPU SLURM Job<a href="#gpu-slurm-job" class="hash-link" aria-label="Direct link to GPU SLURM Job" title="Direct link to GPU SLURM Job" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --job-name=gpu-training</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --output=%x_%j.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --error=%x_%j.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --time=08:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --nodes=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --ntasks=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --cpus-per-task=8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=32G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --gres=gpu:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --partition=gpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER=~/containers/pytorch-gpu.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run with GPU access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --nv \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --bind /data/datasets:/data:ro \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --bind /scratch/$USER:/output \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $CONTAINER python train.py \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --data-dir /data \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --output-dir /output \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --epochs 100</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="multi-gpu-job">Multi-GPU Job<a href="#multi-gpu-job" class="hash-link" aria-label="Direct link to Multi-GPU Job" title="Direct link to Multi-GPU Job" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --job-name=multi-gpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --output=%x_%j.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --error=%x_%j.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --time=24:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --nodes=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --ntasks=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --cpus-per-task=32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=128G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --gres=gpu:4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --partition=gpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --nv ~/containers/pytorch-gpu.sif python -c &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import torch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(f&#x27;GPUs available: {torch.cuda.device_count()}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for i in range(torch.cuda.device_count()):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&#x27;  GPU {i}: {torch.cuda.get_device_name(i)}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run distributed training</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --nv ~/containers/pytorch-gpu.sif \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    torchrun --nproc_per_node=4 train_distributed.py</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="exercise-4-gpu-container-job">Exercise 4: GPU Container Job<a href="#exercise-4-gpu-container-job" class="hash-link" aria-label="Direct link to Exercise 4: GPU Container Job" title="Direct link to Exercise 4: GPU Container Job" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/gpu-job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/gpu-job</span><br></span></code></pre></div></div>
<p>Create a GPU test script:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; gpu_test.py &lt;&lt; &#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/env python3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&quot;&quot;Test GPU availability.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import torch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;=&quot; * 60)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;GPU Container Test&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;=&quot; * 60)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(f&quot;Job ID: {os.environ.get(&#x27;SLURM_JOB_ID&#x27;, &#x27;N/A&#x27;)}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(f&quot;PyTorch: {torch.__version__}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(f&quot;CUDA available: {torch.cuda.is_available()}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if torch.cuda.is_available():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;CUDA version: {torch.version.cuda}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;GPU count: {torch.cuda.device_count()}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i in range(torch.cuda.device_count()):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        props = torch.cuda.get_device_properties(i)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(f&quot;  GPU {i}: {props.name} ({props.total_memory/1e9:.1f} GB)&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Quick test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x = torch.randn(1000, 1000, device=&#x27;cuda&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y = torch.matmul(x, x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(f&quot;\nGPU computation test: PASSED&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;\nNo GPU detected. Did you use --nv flag?&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(&quot;=&quot; * 60)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<p>Create job script:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; gpu_job.sh &lt;&lt; &#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --job-name=gpu-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --output=%x_%j.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --error=%x_%j.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --time=00:15:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --nodes=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --ntasks=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --cpus-per-task=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=16G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --gres=gpu:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --partition=gpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --nv ~/containers/pytorch-gpu.sif python ~/gpu-job/gpu_test.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="mpi-jobs-with-containers">MPI Jobs with Containers<a href="#mpi-jobs-with-containers" class="hash-link" aria-label="Direct link to MPI Jobs with Containers" title="Direct link to MPI Jobs with Containers" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-mpi-containers">Running MPI Containers<a href="#running-mpi-containers" class="hash-link" aria-label="Direct link to Running MPI Containers" title="Direct link to Running MPI Containers" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --job-name=mpi-container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --output=%x_%j.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --error=%x_%j.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --time=02:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --nodes=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --ntasks-per-node=16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=64G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load openmpi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use host MPI to launch container processes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpirun -np $SLURM_NTASKS apptainer exec ~/containers/mpi-app.sif /app/parallel_sim</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="hybrid-mpi--openmp">Hybrid MPI + OpenMP<a href="#hybrid-mpi--openmp" class="hash-link" aria-label="Direct link to Hybrid MPI + OpenMP" title="Direct link to Hybrid MPI + OpenMP" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --job-name=hybrid-mpi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --output=%x_%j.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --error=%x_%j.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --time=04:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --nodes=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --ntasks-per-node=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --cpus-per-task=8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=64G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load openmpi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export OMP_NUM_THREADS=$SLURM_CPUS_PER_TASK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpirun -np $SLURM_NTASKS apptainer exec \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --env OMP_NUM_THREADS=$OMP_NUM_THREADS \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ~/containers/hybrid-app.sif /app/hybrid_code</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="array-jobs">Array Jobs<a href="#array-jobs" class="hash-link" aria-label="Direct link to Array Jobs" title="Direct link to Array Jobs" translate="no">​</a></h2>
<p>Process multiple inputs efficiently:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --job-name=array-container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --output=logs/%x_%A_%a.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --error=logs/%x_%A_%a.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --time=01:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --nodes=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --ntasks=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --cpus-per-task=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=8G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --array=1-100%20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># %20 limits concurrent jobs to 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use array task ID to select input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INPUT_FILE=/data/inputs/sample_${SLURM_ARRAY_TASK_ID}.csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OUTPUT_FILE=/data/outputs/result_${SLURM_ARRAY_TASK_ID}.csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Array task $SLURM_ARRAY_TASK_ID: Processing $INPUT_FILE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --bind /data:/data ~/containers/analysis.sif \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    python process.py --input $INPUT_FILE --output $OUTPUT_FILE</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="environment-variables">Environment Variables<a href="#environment-variables" class="hash-link" aria-label="Direct link to Environment Variables" title="Direct link to Environment Variables" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="passing-variables-to-containers">Passing Variables to Containers<a href="#passing-variables-to-containers" class="hash-link" aria-label="Direct link to Passing Variables to Containers" title="Direct link to Passing Variables to Containers" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Using --env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --env MY_VAR=value container.sif printenv MY_VAR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Multiple variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --env VAR1=value1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --env VAR2=value2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container.sif python script.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># From host environment using APPTAINERENV_ prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export APPTAINERENV_MY_VAR=&quot;hello&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec container.sif printenv MY_VAR</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="slurm-variables-in-containers">SLURM Variables in Containers<a href="#slurm-variables-in-containers" class="hash-link" aria-label="Direct link to SLURM Variables in Containers" title="Direct link to SLURM Variables in Containers" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SLURM variables are automatically available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec container.sif python -c &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(f&#x27;Job ID: {os.environ.get(\&quot;SLURM_JOB_ID\&quot;)}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(f&#x27;Node: {os.environ.get(\&quot;SLURM_NODEID\&quot;)}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(f&#x27;CPUs: {os.environ.get(\&quot;SLURM_CPUS_PER_TASK\&quot;)}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="clean-environment">Clean Environment<a href="#clean-environment" class="hash-link" aria-label="Direct link to Clean Environment" title="Direct link to Clean Environment" translate="no">​</a></h3>
<p>Start with minimal environment:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Ignore host environment variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --cleanenv container.sif env</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-optimization">Performance Optimization<a href="#performance-optimization" class="hash-link" aria-label="Direct link to Performance Optimization" title="Direct link to Performance Optimization" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="use-local-scratch-for-io">Use Local Scratch for I/O<a href="#use-local-scratch-for-io" class="hash-link" aria-label="Direct link to Use Local Scratch for I/O" title="Direct link to Use Local Scratch for I/O" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy data to fast local storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LOCAL_DATA=/scratch/$USER/job_$SLURM_JOB_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $LOCAL_DATA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -r /data/input/* $LOCAL_DATA/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run with local data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --bind $LOCAL_DATA:/data container.sif python process.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy results back</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -r $LOCAL_DATA/results /data/output/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf $LOCAL_DATA</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="store-containers-on-fast-storage">Store Containers on Fast Storage<a href="#store-containers-on-fast-storage" class="hash-link" aria-label="Direct link to Store Containers on Fast Storage" title="Direct link to Store Containers on Fast Storage" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Store frequently-used containers on scratch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp ~/containers/large-container.sif /scratch/$USER/containers/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use from scratch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec /scratch/$USER/containers/large-container.sif python app.py</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="avoid-unnecessary-bind-mounts">Avoid Unnecessary Bind Mounts<a href="#avoid-unnecessary-bind-mounts" class="hash-link" aria-label="Direct link to Avoid Unnecessary Bind Mounts" title="Direct link to Avoid Unnecessary Bind Mounts" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Bad: Many small mounts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec -B /d1:/d1 -B /d2:/d2 -B /d3:/d3 ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Good: Mount parent directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec -B /data:/data container.sif ...</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-issues-and-solutions">Common Issues and Solutions<a href="#common-issues-and-solutions" class="hash-link" aria-label="Direct link to Common Issues and Solutions" title="Direct link to Common Issues and Solutions" translate="no">​</a></h3>
<p><strong>Container not found:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check the path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls -la ~/containers/mycontainer.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use absolute path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec /home/user/containers/mycontainer.sif ...</span><br></span></code></pre></div></div>
<p><strong>Permission denied:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check file permissions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls -la container.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Make readable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod +r container.sif</span><br></span></code></pre></div></div>
<p><strong>&quot;Command not found&quot; inside container:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check what&#x27;s available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec container.sif ls /usr/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec container.sif which python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use full path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec container.sif /usr/local/bin/python</span><br></span></code></pre></div></div>
<p><strong>GPU not found:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Did you forget --nv?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --nv container.sif nvidia-smi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check SLURM allocation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $CUDA_VISIBLE_DEVICES</span><br></span></code></pre></div></div>
<p><strong>Out of disk space during pull:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Set cache to scratch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export APPTAINER_CACHEDIR=/scratch/$USER/.apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $APPTAINER_CACHEDIR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer pull docker://large/image</span><br></span></code></pre></div></div>
<p><strong>Job runs out of memory:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Increase SLURM memory allocation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=64G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Or limit container memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --memory 60G container.sif python memory_heavy.py</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="job-script-templates">Job Script Templates<a href="#job-script-templates" class="hash-link" aria-label="Direct link to Job Script Templates" title="Direct link to Job Script Templates" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="template-standard-cpu-job">Template: Standard CPU Job<a href="#template-standard-cpu-job" class="hash-link" aria-label="Direct link to Template: Standard CPU Job" title="Direct link to Template: Standard CPU Job" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --job-name=cpu-container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --output=%x_%j.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --error=%x_%j.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --time=04:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --nodes=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --ntasks=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --cpus-per-task=8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=32G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER=~/containers/myapp.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORK_DIR=$(pwd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --bind $WORK_DIR:/work \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --pwd /work \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $CONTAINER python script.py --input data.csv --output results.csv</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="template-gpu-deep-learning">Template: GPU Deep Learning<a href="#template-gpu-deep-learning" class="hash-link" aria-label="Direct link to Template: GPU Deep Learning" title="Direct link to Template: GPU Deep Learning" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --job-name=dl-training</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --output=%x_%j.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --error=%x_%j.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --time=24:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --nodes=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --ntasks=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --cpus-per-task=16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=64G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --gres=gpu:4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --partition=gpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER=~/containers/pytorch-gpu.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DATA_DIR=/data/datasets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OUTPUT_DIR=/scratch/$USER/training_$SLURM_JOB_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $OUTPUT_DIR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --nv \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --bind $DATA_DIR:/data:ro \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --bind $OUTPUT_DIR:/output \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $CONTAINER python train.py \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --data /data \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --output /output \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --epochs 100 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --batch-size 64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Save final model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp $OUTPUT_DIR/best_model.pt /data/models/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="template-bioinformatics-pipeline">Template: Bioinformatics Pipeline<a href="#template-bioinformatics-pipeline" class="hash-link" aria-label="Direct link to Template: Bioinformatics Pipeline" title="Direct link to Template: Bioinformatics Pipeline" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --job-name=bio-pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --output=%x_%j.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --error=%x_%j.err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --time=12:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --nodes=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --ntasks=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --cpus-per-task=16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#SBATCH --mem=64G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Containers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FASTQC=~/containers/fastqc.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BWA=~/containers/bwa.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SAMTOOLS=~/containers/samtools.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Paths</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">READS=/data/raw_reads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REF=/data/reference/genome.fa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OUT=/scratch/$USER/pipeline_$SLURM_JOB_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $OUT/{qc,aligned,sorted}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Step 1: Quality control&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --bind /data:/data,$OUT:/out $FASTQC \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fastqc $READS/*.fastq.gz -o /out/qc -t $SLURM_CPUS_PER_TASK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Step 2: Alignment&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --bind /data:/data,$OUT:/out $BWA \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bwa mem -t $SLURM_CPUS_PER_TASK $REF $READS/*_R1.fastq.gz $READS/*_R2.fastq.gz \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &gt; $OUT/aligned/sample.sam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Step 3: Sort and index&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --bind $OUT:/out $SAMTOOLS \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    samtools sort -@ $SLURM_CPUS_PER_TASK /out/aligned/sample.sam -o /out/sorted/sample.bam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --bind $OUT:/out $SAMTOOLS \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    samtools index /out/sorted/sample.bam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Pipeline complete!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls -lh $OUT/sorted/</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="quick-reference">Quick Reference<a href="#quick-reference" class="hash-link" aria-label="Direct link to Quick Reference" title="Direct link to Quick Reference" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="essential-commands">Essential Commands<a href="#essential-commands" class="hash-link" aria-label="Direct link to Essential Commands" title="Direct link to Essential Commands" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Load module</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module load apptainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Pull image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer pull docker://image:tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer pull output.sif docker://image:tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec image.sif command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --nv image.sif command          # With GPU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer exec --bind /src:/dst image.sif cmd  # With bind mount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Interactive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer shell image.sif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Inspect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apptainer inspect image.sif</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-flags">Common Flags<a href="#common-flags" class="hash-link" aria-label="Direct link to Common Flags" title="Direct link to Common Flags" translate="no">​</a></h3>
<table><thead><tr><th>Flag</th><th>Purpose</th></tr></thead><tbody><tr><td><code>--nv</code></td><td>Enable NVIDIA GPU</td></tr><tr><td><code>--bind</code>, <code>-B</code></td><td>Bind mount directories</td></tr><tr><td><code>--env</code>, <code>-e</code></td><td>Set environment variable</td></tr><tr><td><code>--cleanenv</code></td><td>Start with clean environment</td></tr><tr><td><code>--pwd</code></td><td>Set working directory</td></tr><tr><td><code>--contain</code></td><td>Minimal isolation</td></tr><tr><td><code>--writable-tmpfs</code></td><td>Writable overlay</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" translate="no">​</a></h2>
<p>In this tutorial, you learned:</p>
<ul>
<li class="">How to use Apptainer to pull and run Docker images on ACE HPC</li>
<li class="">How to write SLURM job scripts for containerized workloads</li>
<li class="">How to manage data with bind mounts</li>
<li class="">How to run GPU and MPI jobs with containers</li>
<li class="">Performance optimization strategies</li>
<li class="">Troubleshooting common issues</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="additional-resources">Additional Resources<a href="#additional-resources" class="hash-link" aria-label="Direct link to Additional Resources" title="Direct link to Additional Resources" translate="no">​</a></h2>
<ul>
<li class=""><a href="https://apptainer.org/docs/user/latest/" target="_blank" rel="noopener noreferrer" class="">Apptainer User Guide</a></li>
<li class=""><a class="" href="/ace-ug-hpc-wiki/docs/running-jobs/slurm-basics">ACE HPC SLURM Basics</a></li>
<li class=""><a class="" href="/ace-ug-hpc-wiki/docs/running-jobs/sample-scripts">Sample SLURM Scripts</a></li>
<li class=""><a class="" href="/ace-ug-hpc-wiki/docs/support/contact">ACE HPC Support</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tutorials/containers/containers-hpc.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/ace-ug-hpc-wiki/docs/tutorials/containers/containerize-code"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Containerize Your Code</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ace-ug-hpc-wiki/docs/tutorials/containers/advanced-builds"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Advanced Build Topics</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#learning-objectives" class="table-of-contents__link toc-highlight">Learning Objectives</a></li><li><a href="#getting-started-with-apptainer" class="table-of-contents__link toc-highlight">Getting Started with Apptainer</a><ul><li><a href="#loading-the-apptainer-module" class="table-of-contents__link toc-highlight">Loading the Apptainer Module</a></li><li><a href="#pulling-container-images" class="table-of-contents__link toc-highlight">Pulling Container Images</a></li><li><a href="#pull-options" class="table-of-contents__link toc-highlight">Pull Options</a></li><li><a href="#managing-the-cache" class="table-of-contents__link toc-highlight">Managing the Cache</a></li></ul></li><li><a href="#exercise-1-pull-your-first-image" class="table-of-contents__link toc-highlight">Exercise 1: Pull Your First Image</a></li><li><a href="#running-containers" class="table-of-contents__link toc-highlight">Running Containers</a><ul><li><a href="#three-ways-to-run" class="table-of-contents__link toc-highlight">Three Ways to Run</a></li><li><a href="#using-exec-most-common" class="table-of-contents__link toc-highlight">Using <code>exec</code> (Most Common)</a></li><li><a href="#using-shell-interactive" class="table-of-contents__link toc-highlight">Using <code>shell</code> (Interactive)</a></li><li><a href="#using-run-default-action" class="table-of-contents__link toc-highlight">Using <code>run</code> (Default Action)</a></li></ul></li><li><a href="#exercise-2-run-commands-in-containers" class="table-of-contents__link toc-highlight">Exercise 2: Run Commands in Containers</a></li><li><a href="#understanding-bind-mounts" class="table-of-contents__link toc-highlight">Understanding Bind Mounts</a><ul><li><a href="#verifying-default-binds" class="table-of-contents__link toc-highlight">Verifying Default Binds</a></li><li><a href="#custom-bind-mounts" class="table-of-contents__link toc-highlight">Custom Bind Mounts</a></li></ul></li><li><a href="#slurm-job-scripts-for-containers" class="table-of-contents__link toc-highlight">SLURM Job Scripts for Containers</a><ul><li><a href="#basic-container-job" class="table-of-contents__link toc-highlight">Basic Container Job</a></li><li><a href="#job-with-data-binding" class="table-of-contents__link toc-highlight">Job with Data Binding</a></li></ul></li><li><a href="#exercise-3-submit-a-container-job" class="table-of-contents__link toc-highlight">Exercise 3: Submit a Container Job</a></li><li><a href="#gpu-jobs-with-containers" class="table-of-contents__link toc-highlight">GPU Jobs with Containers</a><ul><li><a href="#enabling-gpu-access" class="table-of-contents__link toc-highlight">Enabling GPU Access</a></li><li><a href="#gpu-slurm-job" class="table-of-contents__link toc-highlight">GPU SLURM Job</a></li><li><a href="#multi-gpu-job" class="table-of-contents__link toc-highlight">Multi-GPU Job</a></li></ul></li><li><a href="#exercise-4-gpu-container-job" class="table-of-contents__link toc-highlight">Exercise 4: GPU Container Job</a></li><li><a href="#mpi-jobs-with-containers" class="table-of-contents__link toc-highlight">MPI Jobs with Containers</a><ul><li><a href="#running-mpi-containers" class="table-of-contents__link toc-highlight">Running MPI Containers</a></li><li><a href="#hybrid-mpi--openmp" class="table-of-contents__link toc-highlight">Hybrid MPI + OpenMP</a></li></ul></li><li><a href="#array-jobs" class="table-of-contents__link toc-highlight">Array Jobs</a></li><li><a href="#environment-variables" class="table-of-contents__link toc-highlight">Environment Variables</a><ul><li><a href="#passing-variables-to-containers" class="table-of-contents__link toc-highlight">Passing Variables to Containers</a></li><li><a href="#slurm-variables-in-containers" class="table-of-contents__link toc-highlight">SLURM Variables in Containers</a></li><li><a href="#clean-environment" class="table-of-contents__link toc-highlight">Clean Environment</a></li></ul></li><li><a href="#performance-optimization" class="table-of-contents__link toc-highlight">Performance Optimization</a><ul><li><a href="#use-local-scratch-for-io" class="table-of-contents__link toc-highlight">Use Local Scratch for I/O</a></li><li><a href="#store-containers-on-fast-storage" class="table-of-contents__link toc-highlight">Store Containers on Fast Storage</a></li><li><a href="#avoid-unnecessary-bind-mounts" class="table-of-contents__link toc-highlight">Avoid Unnecessary Bind Mounts</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#common-issues-and-solutions" class="table-of-contents__link toc-highlight">Common Issues and Solutions</a></li></ul></li><li><a href="#job-script-templates" class="table-of-contents__link toc-highlight">Job Script Templates</a><ul><li><a href="#template-standard-cpu-job" class="table-of-contents__link toc-highlight">Template: Standard CPU Job</a></li><li><a href="#template-gpu-deep-learning" class="table-of-contents__link toc-highlight">Template: GPU Deep Learning</a></li><li><a href="#template-bioinformatics-pipeline" class="table-of-contents__link toc-highlight">Template: Bioinformatics Pipeline</a></li></ul></li><li><a href="#quick-reference" class="table-of-contents__link toc-highlight">Quick Reference</a><ul><li><a href="#essential-commands" class="table-of-contents__link toc-highlight">Essential Commands</a></li><li><a href="#common-flags" class="table-of-contents__link toc-highlight">Common Flags</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#additional-resources" class="table-of-contents__link toc-highlight">Additional Resources</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/ace-ug-hpc-wiki/docs/intro">Get Started</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Quick Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://ace.ac.ug" target="_blank" rel="noopener noreferrer" class="footer__link-item">ACE Website<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.niaid.nih.gov/research/african-centers-excellence" target="_blank" rel="noopener noreferrer" class="footer__link-item">NIAID/NIH<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/AceUganda?t=xKzAByMBVx5YtuP29hT95A&amp;s=08" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 ACE WIKI, ACE - Uganda. Wasukira Ian.</div></div></div></footer></div>
</body>
</html>