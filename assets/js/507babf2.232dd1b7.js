"use strict";(globalThis.webpackChunkace_wiki=globalThis.webpackChunkace_wiki||[]).push([[4054],{6738:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"tutorials/containers/containerize-code","title":"Containerize Your Code","description":"This tutorial teaches you how to create container images for your applications using Dockerfiles. By the end, you\'ll be able to package any application into a portable container.","source":"@site/docs/tutorials/containers/containerize-code.md","sourceDirName":"tutorials/containers","slug":"/tutorials/containers/containerize-code","permalink":"/ace-ug-hpc-wiki/docs/tutorials/containers/containerize-code","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tutorials/containers/containerize-code.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"containerize-code","title":"Containerize Your Code","sidebar_label":"Containerize Your Code","sidebar_position":2},"sidebar":"wikiSidebar","previous":{"title":"What are Containers ?","permalink":"/ace-ug-hpc-wiki/docs/tutorials/containers/intro"},"next":{"title":"Containers on HPC","permalink":"/ace-ug-hpc-wiki/docs/tutorials/containers/containers-hpc"}}');var r=i(4848),t=i(8453);const a={id:"containerize-code",title:"Containerize Your Code",sidebar_label:"Containerize Your Code",sidebar_position:2},l="Containerize Your Code",c={},o=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"What is a Dockerfile?",id:"what-is-a-dockerfile",level:2},{value:"Dockerfile Instructions Reference",id:"dockerfile-instructions-reference",level:2},{value:"Exercise 1: Your First Dockerfile",id:"exercise-1-your-first-dockerfile",level:2},{value:"Step 1: Create a Project Directory",id:"step-1-create-a-project-directory",level:3},{value:"Step 2: Create a Python Script",id:"step-2-create-a-python-script",level:3},{value:"Step 3: Write the Dockerfile",id:"step-3-write-the-dockerfile",level:3},{value:"Step 4: Build the Image",id:"step-4-build-the-image",level:3},{value:"Step 5: Run the Container",id:"step-5-run-the-container",level:3},{value:"Understanding Base Images",id:"understanding-base-images",level:2},{value:"Common Base Images",id:"common-base-images",level:3},{value:"Choosing a Base Image",id:"choosing-a-base-image",level:3},{value:"Exercise 2: Python Data Science Container",id:"exercise-2-python-data-science-container",level:2},{value:"Step 1: Create Project Files",id:"step-1-create-project-files",level:3},{value:"Step 2: Write the Dockerfile",id:"step-2-write-the-dockerfile",level:3},{value:"Step 3: Build and Test",id:"step-3-build-and-test",level:3},{value:"Working with Files and Dependencies",id:"working-with-files-and-dependencies",level:2},{value:"Copying Files",id:"copying-files",level:3},{value:"Using .dockerignore",id:"using-dockerignore",level:3},{value:"Installing System Packages",id:"installing-system-packages",level:3},{value:"Exercise 3: R Statistical Container",id:"exercise-3-r-statistical-container",level:2},{value:"Step 1: Create Project Files",id:"step-1-create-project-files-1",level:3},{value:"Step 2: Write the Dockerfile",id:"step-2-write-the-dockerfile-1",level:3},{value:"Step 3: Build and Run",id:"step-3-build-and-run",level:3},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Setting Environment Variables",id:"setting-environment-variables",level:3},{value:"Using ARG for Build-time Variables",id:"using-arg-for-build-time-variables",level:3},{value:"Pushing to Container Registries",id:"pushing-to-container-registries",level:2},{value:"Docker Hub",id:"docker-hub",level:3},{value:"GitHub Container Registry",id:"github-container-registry",level:3},{value:"Using Your Image on ACE HPC",id:"using-your-image-on-ace-hpc",level:3},{value:"Exercise 4: Complete Workflow",id:"exercise-4-complete-workflow",level:2},{value:"Step 1: Create a Bioinformatics Tool Container",id:"step-1-create-a-bioinformatics-tool-container",level:3},{value:"Step 2: Write the Dockerfile",id:"step-2-write-the-dockerfile-2",level:3},{value:"Step 3: Build",id:"step-3-build",level:3},{value:"Step 4: Test Different Usage Patterns",id:"step-4-test-different-usage-patterns",level:3},{value:"Step 5: Push and Use on ACE",id:"step-5-push-and-use-on-ace",level:3},{value:"Dockerfile Best Practices Summary",id:"dockerfile-best-practices-summary",level:2},{value:"1. Order Instructions by Change Frequency",id:"1-order-instructions-by-change-frequency",level:3},{value:"2. Combine RUN Commands",id:"2-combine-run-commands",level:3},{value:"3. Use Specific Tags",id:"3-use-specific-tags",level:3},{value:"4. Don&#39;t Include Secrets",id:"4-dont-include-secrets",level:3},{value:"5. Add Metadata",id:"5-add-metadata",level:3},{value:"Troubleshooting Common Issues",id:"troubleshooting-common-issues",level:2},{value:"Build Fails: &quot;Package not found&quot;",id:"build-fails-package-not-found",level:3},{value:"Build Fails: &quot;Permission denied&quot;",id:"build-fails-permission-denied",level:3},{value:"Image Too Large",id:"image-too-large",level:3},{value:"Container Exits Immediately",id:"container-exits-immediately",level:3},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2},{value:"Additional Resources",id:"additional-resources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"containerize-your-code",children:"Containerize Your Code"})}),"\n",(0,r.jsx)(n.p,{children:"This tutorial teaches you how to create container images for your applications using Dockerfiles. By the end, you'll be able to package any application into a portable container."}),"\n",(0,r.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,r.jsx)(n.p,{children:"After completing this tutorial, you will be able to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Write Dockerfiles from scratch"}),"\n",(0,r.jsx)(n.li,{children:"Understand Dockerfile instructions and best practices"}),"\n",(0,r.jsx)(n.li,{children:"Build container images using Docker"}),"\n",(0,r.jsx)(n.li,{children:"Push images to container registries"}),"\n",(0,r.jsx)(n.li,{children:"Create reproducible research environments"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"what-is-a-dockerfile",children:"What is a Dockerfile?"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.strong,{children:"Dockerfile"})," is a text file containing instructions for building a container image. Think of it as a recipe that describes:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"What base operating system to use"}),"\n",(0,r.jsx)(n.li,{children:"What software to install"}),"\n",(0,r.jsx)(n.li,{children:"What files to include"}),"\n",(0,r.jsx)(n.li,{children:"How to configure the environment"}),"\n",(0,r.jsx)(n.li,{children:"What command to run by default"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Here's a simple example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'# Start from a Python base image\nFROM python:3.11-slim\n\n# Install dependencies\nRUN pip install numpy pandas matplotlib\n\n# Set the working directory\nWORKDIR /app\n\n# Copy your code into the container\nCOPY analysis.py .\n\n# Define the default command\nCMD ["python", "analysis.py"]\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"dockerfile-instructions-reference",children:"Dockerfile Instructions Reference"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Instruction"}),(0,r.jsx)(n.th,{children:"Purpose"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"FROM"})}),(0,r.jsx)(n.td,{children:"Set the base image"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"FROM python:3.11-slim"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"RUN"})}),(0,r.jsx)(n.td,{children:"Execute commands during build"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"RUN pip install numpy"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"COPY"})}),(0,r.jsx)(n.td,{children:"Copy files from host to image"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"COPY src/ /app/"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ADD"})}),(0,r.jsx)(n.td,{children:"Copy files (with URL/tar support)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ADD data.tar.gz /data/"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"WORKDIR"})}),(0,r.jsx)(n.td,{children:"Set working directory"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"WORKDIR /app"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ENV"})}),(0,r.jsx)(n.td,{children:"Set environment variables"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ENV PATH=/app:$PATH"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ARG"})}),(0,r.jsx)(n.td,{children:"Define build-time variables"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ARG VERSION=1.0"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"EXPOSE"})}),(0,r.jsx)(n.td,{children:"Document exposed ports"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"EXPOSE 8080"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"CMD"})}),(0,r.jsx)(n.td,{children:"Default command to run"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'CMD ["python", "app.py"]'})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ENTRYPOINT"})}),(0,r.jsx)(n.td,{children:"Configure container executable"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'ENTRYPOINT ["python"]'})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"LABEL"})}),(0,r.jsx)(n.td,{children:"Add metadata"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'LABEL version="1.0"'})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"USER"})}),(0,r.jsx)(n.td,{children:"Set the user"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"USER appuser"})})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"exercise-1-your-first-dockerfile",children:"Exercise 1: Your First Dockerfile"}),"\n",(0,r.jsx)(n.p,{children:"Let's create a simple Python container step by step."}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-a-project-directory",children:"Step 1: Create a Project Directory"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/my-container\ncd ~/my-container\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-create-a-python-script",children:"Step 2: Create a Python Script"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cat > hello.py << \'EOF\'\n#!/usr/bin/env python3\n"""Simple hello world script."""\n\nimport sys\nimport platform\n\ndef main():\n    print("=" * 50)\n    print("Hello from inside a container!")\n    print("=" * 50)\n    print(f"Python version: {sys.version}")\n    print(f"Platform: {platform.platform()}")\n    print(f"Architecture: {platform.machine()}")\n    print("=" * 50)\n\nif __name__ == "__main__":\n    main()\nEOF\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-write-the-dockerfile",children:"Step 3: Write the Dockerfile"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cat > Dockerfile << \'EOF\'\n# Use official Python image as base\nFROM python:3.11-slim\n\n# Add metadata\nLABEL maintainer="your.email@example.com"\nLABEL description="My first container"\nLABEL version="1.0"\n\n# Set working directory\nWORKDIR /app\n\n# Copy the script\nCOPY hello.py .\n\n# Run the script by default\nCMD ["python", "hello.py"]\nEOF\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-4-build-the-image",children:"Step 4: Build the Image"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Build the image with a tag\ndocker build -t my-hello:1.0 .\n\n# List your images\ndocker images | grep my-hello\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Expected output:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"my-hello    1.0    abc123def    10 seconds ago    125MB\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-5-run-the-container",children:"Step 5: Run the Container"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run my-hello:1.0\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Expected output:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"==================================================\nHello from inside a container!\n==================================================\nPython version: 3.11.x (main, ...) [GCC ...]\nPlatform: Linux-...\nArchitecture: x86_64\n==================================================\n"})}),"\n",(0,r.jsx)(n.p,{children:"Congratulations! You've built and run your first container."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"understanding-base-images",children:"Understanding Base Images"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"FROM"})," instruction specifies your starting point. Choosing the right base image is important."]}),"\n",(0,r.jsx)(n.h3,{id:"common-base-images",children:"Common Base Images"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Image"}),(0,r.jsx)(n.th,{children:"Size"}),(0,r.jsx)(n.th,{children:"Use Case"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ubuntu:22.04"})}),(0,r.jsx)(n.td,{children:"~77MB"}),(0,r.jsx)(n.td,{children:"General purpose, familiar environment"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"debian:bookworm-slim"})}),(0,r.jsx)(n.td,{children:"~74MB"}),(0,r.jsx)(n.td,{children:"Stable, minimal Debian"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"alpine:3.18"})}),(0,r.jsx)(n.td,{children:"~7MB"}),(0,r.jsx)(n.td,{children:"Minimal, security-focused (may have compatibility issues)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"python:3.11"})}),(0,r.jsx)(n.td,{children:"~1GB"}),(0,r.jsx)(n.td,{children:"Full Python with build tools"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"python:3.11-slim"})}),(0,r.jsx)(n.td,{children:"~125MB"}),(0,r.jsx)(n.td,{children:"Python without extras"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"python:3.11-alpine"})}),(0,r.jsx)(n.td,{children:"~50MB"}),(0,r.jsx)(n.td,{children:"Smallest Python (limited compatibility)"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"choosing-a-base-image",children:"Choosing a Base Image"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"# For Python data science work\nFROM python:3.11-slim\n\n# For R analysis\nFROM rocker/r-ver:4.3\n\n# For bioinformatics\nFROM ubuntu:22.04\n\n# For machine learning with GPU\nFROM nvidia/cuda:12.2.0-runtime-ubuntu22.04\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Recommendation"}),": Start with ",(0,r.jsx)(n.code,{children:"-slim"})," variants for a good balance of size and compatibility."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"exercise-2-python-data-science-container",children:"Exercise 2: Python Data Science Container"}),"\n",(0,r.jsx)(n.p,{children:"Let's build a more realistic container for data science work."}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-project-files",children:"Step 1: Create Project Files"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/datascience-container\ncd ~/datascience-container\n"})}),"\n",(0,r.jsx)(n.p,{children:"Create a requirements file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cat > requirements.txt << 'EOF'\nnumpy==1.24.3\npandas==2.0.3\nmatplotlib==3.7.2\nseaborn==0.12.2\nscikit-learn==1.3.0\nEOF\n"})}),"\n",(0,r.jsx)(n.p,{children:"Create an analysis script:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cat > analyze.py << \'EOF\'\n#!/usr/bin/env python3\n"""Sample data analysis script."""\n\nimport numpy as np\nimport pandas as pd\nimport matplotlib\nmatplotlib.use(\'Agg\')  # Use non-interactive backend\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.datasets import load_iris\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.ensemble import RandomForestClassifier\n\ndef main():\n    print("Loading iris dataset...")\n    iris = load_iris()\n    df = pd.DataFrame(iris.data, columns=iris.feature_names)\n    df[\'species\'] = iris.target\n\n    print(f"Dataset shape: {df.shape}")\n    print(f"\\nDataset summary:\\n{df.describe()}")\n\n    # Simple ML model\n    X_train, X_test, y_train, y_test = train_test_split(\n        iris.data, iris.target, test_size=0.2, random_state=42\n    )\n\n    clf = RandomForestClassifier(n_estimators=100, random_state=42)\n    clf.fit(X_train, y_train)\n    accuracy = clf.score(X_test, y_test)\n\n    print(f"\\nRandom Forest Accuracy: {accuracy:.2%}")\n\n    # Create a plot\n    plt.figure(figsize=(10, 6))\n    sns.pairplot(df, hue=\'species\', diag_kind=\'hist\')\n    plt.savefig(\'/output/iris_analysis.png\', dpi=150, bbox_inches=\'tight\')\n    print("\\nPlot saved to /output/iris_analysis.png")\n\nif __name__ == "__main__":\n    main()\nEOF\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-write-the-dockerfile",children:"Step 2: Write the Dockerfile"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cat > Dockerfile << \'EOF\'\n# Python data science container\nFROM python:3.11-slim\n\n# Metadata\nLABEL maintainer="your.email@example.com"\nLABEL description="Python data science environment"\nLABEL version="1.0"\n\n# Install system dependencies for matplotlib\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n    libgomp1 \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Set working directory\nWORKDIR /app\n\n# Copy and install Python dependencies first (for caching)\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\n# Copy application code\nCOPY analyze.py .\n\n# Create output directory\nRUN mkdir -p /output\n\n# Default command\nCMD ["python", "analyze.py"]\nEOF\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-build-and-test",children:"Step 3: Build and Test"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Build the image\ndocker build -t datascience:1.0 .\n\n# Create a local output directory\nmkdir -p output\n\n# Run with volume mount for output\ndocker run -v $(pwd)/output:/output datascience:1.0\n\n# Check the output\nls -la output/\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"working-with-files-and-dependencies",children:"Working with Files and Dependencies"}),"\n",(0,r.jsx)(n.h3,{id:"copying-files",children:"Copying Files"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"# Copy a single file\nCOPY script.py /app/\n\n# Copy multiple files\nCOPY script1.py script2.py /app/\n\n# Copy a directory\nCOPY src/ /app/src/\n\n# Copy with a different name\nCOPY local-config.yaml /app/config.yaml\n\n# Copy everything (use .dockerignore to exclude files)\nCOPY . /app/\n"})}),"\n",(0,r.jsx)(n.h3,{id:"using-dockerignore",children:"Using .dockerignore"}),"\n",(0,r.jsxs)(n.p,{children:["Create a ",(0,r.jsx)(n.code,{children:".dockerignore"})," file to exclude files from the build:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cat > .dockerignore << 'EOF'\n# Git\n.git\n.gitignore\n\n# Python\n__pycache__\n*.pyc\n*.pyo\n.pytest_cache\n.venv\nvenv\n\n# IDE\n.vscode\n.idea\n*.swp\n\n# Data files (usually too large)\n*.csv\n*.parquet\ndata/\n\n# Output\noutput/\n*.log\n\n# Docker\nDockerfile\n.dockerignore\nEOF\n"})}),"\n",(0,r.jsx)(n.h3,{id:"installing-system-packages",children:"Installing System Packages"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"# Debian/Ubuntu based images\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n    build-essential \\\n    curl \\\n    git \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Alpine based images\nRUN apk add --no-cache \\\n    build-base \\\n    curl \\\n    git\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Best Practice"}),": Always combine ",(0,r.jsx)(n.code,{children:"apt-get update"})," with ",(0,r.jsx)(n.code,{children:"apt-get install"})," in the same ",(0,r.jsx)(n.code,{children:"RUN"})," command, and clean up afterward."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"exercise-3-r-statistical-container",children:"Exercise 3: R Statistical Container"}),"\n",(0,r.jsx)(n.p,{children:"Let's create a container for R analysis."}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-project-files-1",children:"Step 1: Create Project Files"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/r-container\ncd ~/r-container\n"})}),"\n",(0,r.jsx)(n.p,{children:"Create an R script:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cat > analysis.R << \'EOF\'\n#!/usr/bin/env Rscript\n# Sample R analysis script\n\nlibrary(tidyverse)\n\ncat("=" , rep("=", 48), "=\\n", sep="")\ncat("R Analysis Container\\n")\ncat("=" , rep("=", 48), "=\\n", sep="")\n\ncat("\\nR version:", R.version.string, "\\n")\ncat("tidyverse version:", as.character(packageVersion("tidyverse")), "\\n")\n\n# Create sample data\nset.seed(42)\ndata <- tibble(\n  x = rnorm(100),\n  y = 2 * x + rnorm(100, sd = 0.5),\n  group = sample(c("A", "B"), 100, replace = TRUE)\n)\n\ncat("\\nDataset summary:\\n")\nprint(summary(data))\n\n# Simple linear model\nmodel <- lm(y ~ x, data = data)\ncat("\\nLinear model summary:\\n")\nprint(summary(model))\n\n# Create a plot\np <- ggplot(data, aes(x = x, y = y, color = group)) +\n  geom_point(alpha = 0.7) +\n  geom_smooth(method = "lm", se = TRUE) +\n  theme_minimal() +\n  labs(title = "Sample Analysis", x = "X Variable", y = "Y Variable")\n\nggsave("/output/analysis_plot.png", p, width = 10, height = 6, dpi = 150)\ncat("\\nPlot saved to /output/analysis_plot.png\\n")\nEOF\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-write-the-dockerfile-1",children:"Step 2: Write the Dockerfile"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cat > Dockerfile << \'EOF\'\n# R statistical computing container\nFROM rocker/tidyverse:4.3\n\n# Metadata\nLABEL maintainer="your.email@example.com"\nLABEL description="R statistical analysis environment"\nLABEL version="1.0"\n\n# Install additional R packages if needed\nRUN R -e "install.packages(c(\'ggplot2\', \'dplyr\'), repos=\'https://cloud.r-project.org\')"\n\n# Set working directory\nWORKDIR /app\n\n# Copy the analysis script\nCOPY analysis.R .\n\n# Create output directory\nRUN mkdir -p /output\n\n# Default command\nCMD ["Rscript", "analysis.R"]\nEOF\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-build-and-run",children:"Step 3: Build and Run"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker build -t r-analysis:1.0 .\nmkdir -p output\ndocker run -v $(pwd)/output:/output r-analysis:1.0\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsx)(n.h3,{id:"setting-environment-variables",children:"Setting Environment Variables"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"# Set a single variable\nENV MY_VAR=value\n\n# Set multiple variables\nENV APP_HOME=/app \\\n    APP_VERSION=1.0 \\\n    PYTHONUNBUFFERED=1\n\n# Use variables in subsequent commands\nWORKDIR $APP_HOME\n"})}),"\n",(0,r.jsx)(n.h3,{id:"using-arg-for-build-time-variables",children:"Using ARG for Build-time Variables"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"# Define build argument with default\nARG PYTHON_VERSION=3.11\n\n# Use in FROM\nFROM python:${PYTHON_VERSION}-slim\n\n# ARG values don't persist to runtime\nARG BUILD_DATE\nLABEL build_date=${BUILD_DATE}\n\n# Convert ARG to ENV if needed at runtime\nARG APP_VERSION=1.0\nENV APP_VERSION=${APP_VERSION}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Build with custom arguments:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker build --build-arg PYTHON_VERSION=3.10 --build-arg BUILD_DATE=$(date -I) -t myapp:1.0 .\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"pushing-to-container-registries",children:"Pushing to Container Registries"}),"\n",(0,r.jsx)(n.h3,{id:"docker-hub",children:"Docker Hub"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Login to Docker Hub\ndocker login\n\n# Tag your image for Docker Hub\ndocker tag datascience:1.0 yourusername/datascience:1.0\n\n# Push to Docker Hub\ndocker push yourusername/datascience:1.0\n"})}),"\n",(0,r.jsx)(n.h3,{id:"github-container-registry",children:"GitHub Container Registry"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Login to GitHub Container Registry\necho $GITHUB_TOKEN | docker login ghcr.io -u USERNAME --password-stdin\n\n# Tag for GHCR\ndocker tag datascience:1.0 ghcr.io/yourusername/datascience:1.0\n\n# Push\ndocker push ghcr.io/yourusername/datascience:1.0\n"})}),"\n",(0,r.jsx)(n.h3,{id:"using-your-image-on-ace-hpc",children:"Using Your Image on ACE HPC"}),"\n",(0,r.jsx)(n.p,{children:"Once pushed, you can use it on ACE:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# On ACE HPC\nmodule load apptainer\n\n# Pull from Docker Hub\napptainer pull docker://yourusername/datascience:1.0\n\n# Or from GitHub Container Registry\napptainer pull docker://ghcr.io/yourusername/datascience:1.0\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"exercise-4-complete-workflow",children:"Exercise 4: Complete Workflow"}),"\n",(0,r.jsx)(n.p,{children:"Let's put it all together with a complete example."}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-a-bioinformatics-tool-container",children:"Step 1: Create a Bioinformatics Tool Container"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/bioinfo-container\ncd ~/bioinfo-container\n"})}),"\n",(0,r.jsx)(n.p,{children:"Create a simple sequence analysis script:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cat > seq_analysis.py << \'EOF\'\n#!/usr/bin/env python3\n"""Simple sequence analysis tool."""\n\nimport argparse\nfrom collections import Counter\n\ndef gc_content(sequence):\n    """Calculate GC content of a DNA sequence."""\n    sequence = sequence.upper()\n    gc = sequence.count(\'G\') + sequence.count(\'C\')\n    return gc / len(sequence) * 100 if sequence else 0\n\ndef nucleotide_freq(sequence):\n    """Calculate nucleotide frequencies."""\n    return Counter(sequence.upper())\n\ndef main():\n    parser = argparse.ArgumentParser(description=\'Analyze DNA sequences\')\n    parser.add_argument(\'--sequence\', \'-s\', type=str, help=\'DNA sequence to analyze\')\n    parser.add_argument(\'--file\', \'-f\', type=str, help=\'File containing sequence\')\n    args = parser.parse_args()\n\n    if args.file:\n        with open(args.file) as f:\n            sequence = \'\'.join(line.strip() for line in f if not line.startswith(\'>\'))\n    elif args.sequence:\n        sequence = args.sequence\n    else:\n        # Default example sequence\n        sequence = "ATGCGATCGATCGATCGATCGATCGATCGATCGATCG"\n\n    print("=" * 50)\n    print("Sequence Analysis Results")\n    print("=" * 50)\n    print(f"Sequence length: {len(sequence)} bp")\n    print(f"GC content: {gc_content(sequence):.2f}%")\n    print("\\nNucleotide frequencies:")\n    for nuc, count in sorted(nucleotide_freq(sequence).items()):\n        print(f"  {nuc}: {count} ({count/len(sequence)*100:.1f}%)")\n    print("=" * 50)\n\nif __name__ == "__main__":\n    main()\nEOF\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-write-the-dockerfile-2",children:"Step 2: Write the Dockerfile"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cat > Dockerfile << \'EOF\'\n# Bioinformatics analysis tool\nFROM python:3.11-slim\n\nLABEL maintainer="your.email@example.com"\nLABEL description="DNA sequence analysis tool"\nLABEL version="1.0"\n\n# Create non-root user for security\nRUN useradd -m -s /bin/bash biouser\n\n# Set working directory\nWORKDIR /app\n\n# Copy application\nCOPY seq_analysis.py .\nRUN chmod +x seq_analysis.py\n\n# Switch to non-root user\nUSER biouser\n\n# Set entrypoint for flexible usage\nENTRYPOINT ["python", "seq_analysis.py"]\n\n# Default arguments (can be overridden)\nCMD ["--help"]\nEOF\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-build",children:"Step 3: Build"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker build -t seq-analysis:1.0 .\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-4-test-different-usage-patterns",children:"Step 4: Test Different Usage Patterns"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Show help\ndocker run seq-analysis:1.0\n\n# Analyze a sequence directly\ndocker run seq-analysis:1.0 --sequence "ATGCGATCGATCGATCG"\n\n# Analyze from a file\necho ">sample" > test.fasta\necho "ATGCGATCGATCGATCGATCGATCGATCG" >> test.fasta\ndocker run -v $(pwd):/data seq-analysis:1.0 --file /data/test.fasta\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-5-push-and-use-on-ace",children:"Step 5: Push and Use on ACE"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Tag and push\ndocker tag seq-analysis:1.0 yourusername/seq-analysis:1.0\ndocker push yourusername/seq-analysis:1.0\n\n# On ACE HPC:\n# module load apptainer\n# apptainer exec docker://yourusername/seq-analysis:1.0 --sequence "ATGCGATCG"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"dockerfile-best-practices-summary",children:"Dockerfile Best Practices Summary"}),"\n",(0,r.jsx)(n.h3,{id:"1-order-instructions-by-change-frequency",children:"1. Order Instructions by Change Frequency"}),"\n",(0,r.jsx)(n.p,{children:"Put instructions that change rarely at the top:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"FROM python:3.11-slim\n\n# System deps (rarely change)\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n    build-essential \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Python deps (change occasionally)\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\n# Application code (changes frequently)\nCOPY src/ /app/src/\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-combine-run-commands",children:"2. Combine RUN Commands"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"# Bad: Multiple layers\nRUN apt-get update\nRUN apt-get install -y curl\nRUN apt-get clean\n\n# Good: Single layer\nRUN apt-get update \\\n    && apt-get install -y --no-install-recommends curl \\\n    && apt-get clean \\\n    && rm -rf /var/lib/apt/lists/*\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-use-specific-tags",children:"3. Use Specific Tags"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"# Bad: Tag can change\nFROM python:latest\n\n# Good: Specific version\nFROM python:3.11.4-slim\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-dont-include-secrets",children:"4. Don't Include Secrets"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"# NEVER do this\nENV API_KEY=secret123\nCOPY credentials.json /app/\n\n# Instead, mount secrets at runtime\n# docker run -v ~/.aws:/root/.aws:ro myimage\n"})}),"\n",(0,r.jsx)(n.h3,{id:"5-add-metadata",children:"5. Add Metadata"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'LABEL maintainer="email@example.com"\nLABEL version="1.0"\nLABEL description="What this container does"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting-common-issues",children:"Troubleshooting Common Issues"}),"\n",(0,r.jsx)(n.h3,{id:"build-fails-package-not-found",children:'Build Fails: "Package not found"'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"# Always update package lists first\nRUN apt-get update && apt-get install -y package-name\n"})}),"\n",(0,r.jsx)(n.h3,{id:"build-fails-permission-denied",children:'Build Fails: "Permission denied"'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"# Make scripts executable\nCOPY script.sh .\nRUN chmod +x script.sh\n\n# Or use proper ownership\nCOPY --chown=user:user files/ /app/\n"})}),"\n",(0,r.jsx)(n.h3,{id:"image-too-large",children:"Image Too Large"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"# Use slim base images\nFROM python:3.11-slim  # Not python:3.11\n\n# Clean up in the same layer\nRUN apt-get update \\\n    && apt-get install -y --no-install-recommends pkg \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Use --no-cache-dir for pip\nRUN pip install --no-cache-dir -r requirements.txt\n"})}),"\n",(0,r.jsx)(n.h3,{id:"container-exits-immediately",children:"Container Exits Immediately"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'# Ensure CMD/ENTRYPOINT keeps running\nCMD ["python", "-u", "app.py"]  # -u for unbuffered output\n\n# Or for debugging, keep container running\nCMD ["tail", "-f", "/dev/null"]\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"In this tutorial, you learned:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"How to write Dockerfiles using common instructions"}),"\n",(0,r.jsx)(n.li,{children:"How to choose appropriate base images"}),"\n",(0,r.jsx)(n.li,{children:"How to manage dependencies and files"}),"\n",(0,r.jsx)(n.li,{children:"How to build and tag images"}),"\n",(0,r.jsx)(n.li,{children:"How to push images to registries"}),"\n",(0,r.jsx)(n.li,{children:"Best practices for efficient, secure containers"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.p,{children:["Continue to ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"advanced-builds",children:"Advanced Build Topics"})})," to learn about:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Multi-stage builds for smaller images"}),"\n",(0,r.jsx)(n.li,{children:"GPU-enabled containers"}),"\n",(0,r.jsx)(n.li,{children:"MPI for parallel computing"}),"\n",(0,r.jsx)(n.li,{children:"Optimization techniques"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.docker.com/engine/reference/builder/",children:"Dockerfile Reference"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/",children:"Docker Build Best Practices"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://hub.docker.com/",children:"Docker Hub"})," - Find and share container images"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>l});var s=i(6540);const r={},t=s.createContext(r);function a(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);