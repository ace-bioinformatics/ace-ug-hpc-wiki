"use strict";(globalThis.webpackChunkace_wiki=globalThis.webpackChunkace_wiki||[]).push([[9570],{5592:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"running-jobs/job-scripts","title":"Writing Job Scripts","description":"SLURM job scripts are used to submit tasks to the cluster. These scripts define the resources required for the job, such as memory, time, and number of processors, as well as the software environment.","source":"@site/docs/running-jobs/job-scripts.md","sourceDirName":"running-jobs","slug":"/running-jobs/job-scripts","permalink":"/ace-ug-hpc-wiki/docs/running-jobs/job-scripts","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/running-jobs/job-scripts.md","tags":[],"version":"current","frontMatter":{"id":"job-scripts","title":"Writing Job Scripts"},"sidebar":"wikiSidebar","previous":{"title":"SLURM Basics","permalink":"/ace-ug-hpc-wiki/docs/running-jobs/slurm-basics"},"next":{"title":"Sample SLURM Job Scripts","permalink":"/ace-ug-hpc-wiki/docs/running-jobs/sample-scripts"}}');var o=n(4848),i=n(8453);const t={id:"job-scripts",title:"Writing Job Scripts"},a=void 0,l={},c=[{value:"Basic Structure of a SLURM Job Script",id:"basic-structure-of-a-slurm-job-script",level:2},{value:"Example SLURM Job Script: BLAST Job",id:"example-slurm-job-script-blast-job",level:3},{value:"Explanation of SLURM Directives",id:"explanation-of-slurm-directives",level:3},{value:"Loading Modules",id:"loading-modules",level:2},{value:"Writing the Commands to Run Your Task",id:"writing-the-commands-to-run-your-task",level:2},{value:"Submitting Your Job",id:"submitting-your-job",level:2},{value:"Monitoring Your Job",id:"monitoring-your-job",level:2},{value:"Checking Output and Errors",id:"checking-output-and-errors",level:2},{value:"Best Practices for Writing SLURM Scripts",id:"best-practices-for-writing-slurm-scripts",level:2},{value:"Example: Another Bioinformatics Task (Hisat2)",id:"example-another-bioinformatics-task-hisat2",level:2},{value:"Troubleshooting Tips",id:"troubleshooting-tips",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.p,{children:"SLURM job scripts are used to submit tasks to the cluster. These scripts define the resources required for the job, such as memory, time, and number of processors, as well as the software environment."}),"\n",(0,o.jsx)(s.p,{children:"This guide will walk you through how to write a basic SLURM job script, using a BLAST (bioinformatics) job as an example."}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsx)(s.h2,{id:"basic-structure-of-a-slurm-job-script",children:"Basic Structure of a SLURM Job Script"}),"\n",(0,o.jsxs)(s.p,{children:["A basic SLURM job script is a shell script that includes SLURM directives (prefixed with ",(0,o.jsx)(s.code,{children:"#SBATCH"}),") to specify job parameters, followed by commands to run the actual task."]}),"\n",(0,o.jsx)(s.h3,{id:"example-slurm-job-script-blast-job",children:"Example SLURM Job Script: BLAST Job"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"#!/bin/bash\n\n#SBATCH --job-name=blast_job       # Name of the job\n#SBATCH --output=blast_job.out     # Output file for standard output\n#SBATCH --error=blast_job.err      # Output file for standard error\n#SBATCH --time=12:00:00            # Maximum run time (HH:MM:SS)\n#SBATCH --nodes=1                  # Number of nodes to allocate\n#SBATCH --ntasks-per-node=8        # Number of tasks per node (set according to your job)\n#SBATCH --mem=32gb                 # Memory allocation per node\n\n# Load the necessary module (in this case, BLAST)\nmodule load blast/2.12.0\n\n# Run your job (example command for BLAST)\nblastn -query input.fasta -db database -out results.txt -num_threads 8\n"})}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsx)(s.h3,{id:"explanation-of-slurm-directives",children:"Explanation of SLURM Directives"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"#!/bin/bash"}),": Specifies the shell to use for running the script (bash in this case)."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"#SBATCH --job-name=blast_job"}),": Assigns a name to your job. This is helpful for identifying the job in the queue."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"#SBATCH --output=blast_job.out"}),": Specifies the file where standard output (stdout) will be saved."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"#SBATCH --error=blast_job.err"}),": Specifies the file where standard error (stderr) will be saved."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"#SBATCH --time=12:00:00"}),": Specifies the maximum run time for the job in the format ",(0,o.jsx)(s.code,{children:"HH:MM:SS"}),". Set this based on how long your task is expected to run."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"#SBATCH --nodes=1"}),": Requests one compute node for the job. If your task needs more nodes, you can increase this number."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"#SBATCH --ntasks-per-node=8"}),": Requests 8 tasks (processes) per node. This is typically set based on how many CPU cores your task needs."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"#SBATCH --mem=32gb"}),": Specifies how much memory to allocate per node. If your task requires more memory, adjust this value."]}),"\n"]}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsx)(s.h2,{id:"loading-modules",children:"Loading Modules"}),"\n",(0,o.jsx)(s.p,{children:"Most HPC systems, including ACE, have software installed in modules. Before you run your job, you may need to load the required software module."}),"\n",(0,o.jsxs)(s.p,{children:["In the example above, ",(0,o.jsx)(s.code,{children:"module load blast/2.12.0"})," loads the specific version of the BLAST software needed for the task."]}),"\n",(0,o.jsx)(s.p,{children:"You can check available modules on your system with:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"module avail\n"})}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsx)(s.h2,{id:"writing-the-commands-to-run-your-task",children:"Writing the Commands to Run Your Task"}),"\n",(0,o.jsxs)(s.p,{children:["After setting up your SLURM directives, you can include the commands to run your job. In the example, the job runs a ",(0,o.jsx)(s.code,{children:"blastn"})," command:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"blastn -query input.fasta -db database -out results.txt -num_threads 8\n"})}),"\n",(0,o.jsxs)(s.p,{children:["This command performs a BLAST search with the input file ",(0,o.jsx)(s.code,{children:"input.fasta"})," against the ",(0,o.jsx)(s.code,{children:"database"}),", saving the results to ",(0,o.jsx)(s.code,{children:"results.txt"}),". The ",(0,o.jsx)(s.code,{children:"-num_threads 8"})," argument tells BLAST to use 8 threads, corresponding to the number of tasks requested in the SLURM job script."]}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsx)(s.h2,{id:"submitting-your-job",children:"Submitting Your Job"}),"\n",(0,o.jsxs)(s.p,{children:["Once your job script is ready, save it to a file, such as ",(0,o.jsx)(s.code,{children:"blast_job.sh"}),". To submit the job to SLURM, use the ",(0,o.jsx)(s.code,{children:"sbatch"})," command:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"sbatch blast_job.sh\n"})}),"\n",(0,o.jsx)(s.p,{children:"You\u2019ll receive a job ID upon submission, which you can use to track or cancel the job."}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsx)(s.h2,{id:"monitoring-your-job",children:"Monitoring Your Job"}),"\n",(0,o.jsxs)(s.p,{children:["After submission, you can monitor the status of your job using ",(0,o.jsx)(s.code,{children:"squeue"}),":"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"squeue -u $USER\n"})}),"\n",(0,o.jsxs)(s.p,{children:["This will list all your active and queued jobs. If your job is running, you'll see its status here. You can also check detailed job information with ",(0,o.jsx)(s.code,{children:"scontrol"}),":"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"scontrol show job <job_id>\n"})}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsx)(s.h2,{id:"checking-output-and-errors",children:"Checking Output and Errors"}),"\n",(0,o.jsxs)(s.p,{children:["After the job completes, check the output and error files you specified (",(0,o.jsx)(s.code,{children:"blast_job.out"})," and ",(0,o.jsx)(s.code,{children:"blast_job.err"}),"). If the job completes successfully, you should find your results in the output file (",(0,o.jsx)(s.code,{children:"results.txt"}),")."]}),"\n",(0,o.jsxs)(s.p,{children:["If your job fails, review the ",(0,o.jsx)(s.code,{children:".err"})," file to find details about what went wrong. Common issues could include incorrect file paths, missing dependencies, or resource allocation problems."]}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsx)(s.h2,{id:"best-practices-for-writing-slurm-scripts",children:"Best Practices for Writing SLURM Scripts"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Resource Allocation"}),": Always request the appropriate resources. If your job uses too many or too few, it may fail to start or cause inefficient resource usage. Adjust ",(0,o.jsx)(s.code,{children:"--mem"}),", ",(0,o.jsx)(s.code,{children:"--time"}),", ",(0,o.jsx)(s.code,{children:"--nodes"}),", and ",(0,o.jsx)(s.code,{children:"--ntasks-per-node"})," according to your task\u2019s requirements."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Modularize Your Script"}),": If your script requires multiple dependencies, load them in sequence using ",(0,o.jsx)(s.code,{children:"module load"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Use Relative Paths"}),": Use relative paths for input/output files (e.g., ",(0,o.jsx)(s.code,{children:"input.fasta"}),") unless your job requires absolute paths."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Test Before Full Run"}),": For large or long-running jobs, try to test your script with a smaller dataset or a shorter run time to ensure everything works as expected."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsx)(s.h2,{id:"example-another-bioinformatics-task-hisat2",children:"Example: Another Bioinformatics Task (Hisat2)"}),"\n",(0,o.jsx)(s.p,{children:"Here\u2019s an example of a job script for a HISAT2 task:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"#!/bin/bash\n#SBATCH --job-name=hisat2_job\n#SBATCH --output=hisat2_job.out\n#SBATCH --error=hisat2_job.err\n#SBATCH --time=02:00:00\n#SBATCH --nodes=1\n#SBATCH --ntasks-per-node=8\n#SBATCH --mem=16gb\n\nmodule load hisat2/2.2.1\n\nhisat2 -p 8 -x genome_index -U reads.fastq -S output.sam\n"})}),"\n",(0,o.jsx)(s.p,{children:"In this example:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"-p 8"}),": Uses 8 threads."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"-x genome_index"}),": Specifies the genome index for alignment."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"-U reads.fastq"}),": Input file for single-end reads."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"-S output.sam"}),": Output SAM file."]}),"\n"]}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsx)(s.h2,{id:"troubleshooting-tips",children:"Troubleshooting Tips"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Job won't start"}),": Check if there are sufficient resources available with ",(0,o.jsx)(s.code,{children:"squeue"})," or ",(0,o.jsx)(s.code,{children:"sinfo"}),". If needed, reduce resource requests like ",(0,o.jsx)(s.code,{children:"--time"})," or ",(0,o.jsx)(s.code,{children:"--mem"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Job fails with segmentation fault"}),": Test the job interactively (",(0,o.jsx)(s.code,{children:"salloc"}),") to debug any code issues in a smaller test."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Incorrect output"}),": Ensure all file paths are correct and that you\u2019re using the correct module versions."]}),"\n"]}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsx)(s.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsx)(s.p,{children:"Writing and submitting a SLURM job script is the standard way to run tasks on the ACE HPC Cluster. By setting appropriate resource limits, loading necessary software modules, and properly writing the commands to run your tasks, you can efficiently use the cluster\u2019s resources."}),"\n",(0,o.jsxs)(s.p,{children:["For more examples and advanced topics, refer to the ",(0,o.jsx)(s.a,{href:"https://slurm.schedmd.com/documentation.html",children:"SLURM documentation"}),"."]})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>a});var r=n(6540);const o={},i=r.createContext(o);function t(e){const s=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);